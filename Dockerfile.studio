FROM node:20-alpine

# Install pnpm
RUN npm install -g pnpm

WORKDIR /app

# Copy package.json and workspace config
COPY package.json ./
COPY pnpm-workspace.yaml ./

# Copy lock file if it exists
COPY pnpm-lock.yaml* ./

# Copy packages
COPY packages ./packages

# Install dependencies
RUN pnpm install

# Set working directory to db package
WORKDIR /app/packages/db

EXPOSE 4983

# Run studio
CMD ["pnpm", "run", "studio"]